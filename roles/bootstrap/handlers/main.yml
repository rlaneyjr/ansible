---
- name: restart ssh
  action: service name=ssh state=restarted

- name: restart resolvconf
  action: service name=resolvconf state=restarted

- name: run resolvconf
  command: resolvconf -u

- name: run grub-mkconfig
  command: grub-mkconfig -o /boot/grub/grub.cfg

- name: update tzdata
  command: /usr/sbin/dpkg-reconfigure --frontend noninteractive tzdata

- name: restart machine
  command: reboot now "Ansible updates triggered"
  async: 0
  poll: 0
  ignore_errors: true
  when: reboot == "yes"

- name: waiting for server to come back
  sudo: False
  local_action: wait_for host={{ inventory_hostname }} port=22 delay=1 timeout=300
  when: reboot == "yes"
